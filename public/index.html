<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Chartbreaker</title>
	<style>
		canvas {
			border: 1px solid #ccc;
		}
	</style>
</head>
<body>
	<div class="chartbreaker">
	</div>

	<script>
		var target = document.querySelector('.chartbreaker');
		var canvas = document.createElement('canvas');
		canvas.height = 300;
		canvas.width = 400;

		var plotData = [240, 180, 220, 40];

		var rectH = 240;
		var rectH2 = 180;
		var rectW = 50 >= canvas.width / plotData.length ? canvas.width / plotData.length : 50;
		var spacer = (canvas.width - (plotData.length * rectW)) / (plotData.length + 1);

		var context = canvas.getContext('2d');
		context.fillStyle = '#ff0033';

		target.appendChild(canvas);

		var generateZeroArray = function(num){
			var arry = [];
			for(var i = 0; i < num; i += 1){
				arry.push(0);
			};
			return arry;
		};

		var zeroArray = generateZeroArray(plotData.length);
		var reduceHandler = function(preVal, curVal){
			return preVal + curVal;
		};

		var plotTotal, zeroTotal;
		plotTotal = plotData.reduce(reduceHandler);

		var doChart = function(){

			context.clearRect(0, 0, canvas.width, canvas.height);
			plotData.forEach(function(plot, idx){
				var newPlot = (zeroArray[idx] >= plotData[idx]) ? plotData[idx] : Math.ceil((plotData[idx] - zeroArray[idx]) / 25);
				if(plotData[idx] > zeroArray[idx]){
					zeroArray[idx] += newPlot;
				} else {
					zeroArray[idx] = newPlot;
				}
				var xpos = idx > 0 ? (spacer * (idx + 1)) + (rectW * idx) : spacer;
				context.fillRect(xpos, (canvas.height - zeroArray[idx]), rectW, zeroArray[idx]);
			});

			if(plotTotal > zeroArray.reduce(reduceHandler)){
				requestAnimationFrame(doChart);
			}
		}

		requestAnimationFrame(doChart);
	</script>
</body>
</html>
